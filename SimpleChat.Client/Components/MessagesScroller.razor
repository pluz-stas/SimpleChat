<div class="messagesWrapper" id="messagesList">
    @for (var i = messages.Count - 1; i >= 0; i--)
    {
        var message = messages[i];
        var previousMessage = i > 0 ? messages[i - 1] : null;
        var nextMessage = i + 1 < messages.Count ? messages[i + 1] : null;
        var uid = message.User.UserId;

        PreRenderMessage(message, previousMessage, nextMessage, uid, out bool isDefaultAvatar, out bool isCurrentUserMessage, out bool isDateSplit);
        
        <div class=@(isDateSplit ? "dateSplit" : "d-none")>
            @message.CreatedDate.ToShortDateString()
        </div>
        <div class="messageRow">
            <div class="messageUserAvatarWrap">
                <img class="messageUserAvatar" src=@(message.User.UserImg ?? (isDefaultAvatar ? DefaultAvatar : ""))
                     style=@(!isDefaultAvatar && message.User.UserImg == null ? "display: none" : "")>
            </div>
            <div class=@(isCurrentUserMessage ? "imMessageWrap" : "smbdMessageWrap")>
                <div class="textColumn">
                    <div class="messageUserName">@message.User.UserName</div >
        <div class="messageContent">@message.Content</div>
                </div>
            </div>
            <div class="messageMetaWrap">
                <div class="messageMeta">@message.CreatedDate.ToLocalTime().ToShortTimeString()</div>
            </div>
        </div>
    }
</div>